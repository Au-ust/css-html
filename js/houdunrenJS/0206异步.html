<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        div {
            width: 100px;
            height: 100px;
            background: yellowgreen;
            text-align: center;
            color: aliceblue;
            font-size: 80px;
            position: absolute;
        }
    </style>
</head>

<body>
    <div id="hd"></div>
    <script src="./ajax.js"></script>
    <script>
    function handle() {
        let i = 0;
        (function run() {
            hd.innerHTML = i;
            hd.style.width = i + "%";
            if (++i <= 100) {
                setTimeout(run, 20);
            }
        })();
    }
handle()
//     async function hd(name) {
//         try{
//             let user = await ajax(`http://localhost:8888/php/user.php?name=${name}`);
//             let lessons = await ajax(
//                 `http://localhost:8888/php/houdunren.php?id=${user.id}`
//             );
//             return lessons;
// }catch(error){
//     alert(error.message)
// }
//     }
//     hd("后盾人教程")
//         .then(lessons => {
//             console.log(lessons);
//         })

    // class User {
    //         async get(name) {
    //             let user = await ajax(
    //                 `http://localhost:8888/php/user.php?name=${name}`
    //             );
    //             user.name += "-houdunren.com";
    //             return user;
    //         }
    //     }
    //     new User().get("后盾人").then(user => {
    //         console.log(user);
    //     });

// async function sleep(delay=2000) {
//     return new Promise(resolve=>{
//         setTimeout(()=>{
//             resolve()
//         },delay)
//     })
// }
// async function show() {
//     for(const user of ['我是1','我是2']){
//        await sleep()//不加await会直接打印内容，不会延迟
//        //因为await要等待new Promise返回过来
//         console.log(user)
//     }
// }
// show()


    // function hd() {
    //     new Promise(resolve => {
    //         setTimeout(() => {
    //             resolve("后盾人");
    //         }, 2000);
    //     })
    //         .then(name => {
    //             return new Promise(resolve => {
    //                 setTimeout(() => {
    //                     resolve(name + "houdunren.com");
    //                 }, 2000);
    //             });
    //         })
    //         .then(site => {
    //             console.log(site);
    //         })
    // }

    // hd()//后盾人houdunren.com

            // async function hd() {
            //     let name = await new Promise(resolve => {
            //         setTimeout(() => {
            //             resolve("后盾人");
            //         }, 2000);
            //     });
            //     let site = await new Promise(resolve => {
            //         setTimeout(() => {
            //             resolve(name + "houdunren.com");
            //         }, 2000);
            //     });
            //     console.log(site)
            // }
            // hd()//后盾人houdunren.com
//     async function example() {
//     return '我是async'
// }
// example().then(v=>{console.log(typeof v)})//我是async
// function queue(arr){
//     arr.reduce((promise,n)=>{
//         return promise.then(_=>{
//       return new Promise(resolve => {
//                 setTimeout(() => {
//                     console.log(n);
//                     resolve();
//                 }, 1000);
//             });
//         });
//     }, Promise.resolve());//设置reduce的初始值为一个已经resolved的promise
//         }
//         queue([1, 2, 3, 4]);

// function queue(num){
//     let promise=Promise.resolve()
//     num.map(v=>{
//         promise=promise.then(_=>{
//             return v()
//             })
//         })
//     }

//     function p1() {
//         return new Promise(resolve => {
//             setTimeout(() => {
//                 console.log("p1");
//                 resolve();
//             }, 1000);
//         });
//     }
//     function p2() {
//         return new Promise(resolve => {
//             setTimeout(() => {
//                 console.log("p2");
//                 resolve();
//             }, 1000);
//         });
//     }
//     queue([p1, p2]);

        // let promise = Promise.resolve("后盾人");
        // promise = promise.then(v => {
        //     return new Promise(resolve => {
        //         setTimeout(() => {
        //             console.log(1);
        //             resolve();
        //         }, 1000);
        //     });
        // });
        // promise.then(v => {
        //     return new Promise(resolve => {
        //         setTimeout(() => {
        //             console.log(2);
        //             resolve();
        //         }, 1000);
        //     });
        // });

    // const first = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     resolve("第一个异步，我比较快");
    //   }, 200);
    // });
    // const second = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     resolve("第二个异步，我比较慢");
    //   }, 1000);
    // });
    // Promise.race([first,second])
    //   .then(results => {
    //     console.log(results);
    //   })
    //   .catch(msg => {
    //     console.log(msg);
    //   });

    // const p1 = new Promise((resolve, reject) => {
    //   reject("rejected");
    // });
    // const p2 = new Promise((resolve, reject) => {
    //   resolve("resolved");
    // });
    // Promise.allSettled([p1, p2]).then(results => {
    //   console.log(results);
    // });

    // function getUsers(names) {
    //     let promises = names.map(name => {
    //         return ajax(`http://localhost:8081/home/name/front_end/js/houdunrenJS/user.php?name=${name}`);
    //     });
    //     return Promise.all(promises);
    // }
    // getUsers(["后盾人"]).then(users => {
    //     console.log(users);
    // });

//  const first=new Promise((resolve,reject)=>{
//     setTimeout(()=>{
//         resolve('第一个异步')
//     },1000)
//  })//需等待一秒
//  const second=new Promise((reslove,reject)=>{
//     reslove('第二个异步')
//  })//立即可以返回
//  Promise.all([first,second]).then(res=>{
//     console.log(res)//等待一秒再执行then
//  })
    // new Promise((resolve, reject) => {
    //     resolve("后盾人");
    // })
    //     .then(value => {
    //         if (value != "成功") {
    //             // throw new Error("fail");
    //             return Promise.reject("参数错误");
    //         }
    //     })
    //     .catch(error => {
    //         console.log(error + "fail");
    //     });

        // Promise.hd = function (value) {
        //     return new Promise(resolve => {
        //         resolve(value);
        //     });
        // };
        // Promise.hd("后盾人").then(value => {
        //     console.log(value);
        // });
        // function query(name) {
        //     const cache = query.cache || (query.cache = new Map());
        //     if (cache.has(name)) {
        //         console.log("走缓存了");
        //         return Promise.resolve(cache.get(name));
        //     }
        //     return ajax(`http://localhost:8888/php/user.php?name=${name}`).then(
        //         user => {
        //             cache.set(name, user);
        //             console.log("没走缓存");
        //             return user;
        //         }
        //     );
        // }
        
//         Promise.resolve('我是成功状态').then(
//             value=>{
// console.log('进入成功状态') 
//             },lose=>{
//                 console.log('进入失败状态')
//             })

        // function loadScript(src){
        //     return new Promise((reslove,reject)=>{
        //         const script=document.createElement('script')
        //         script.src=src
        //         script.onload=()=>reslove(script)
        //         script.onerror=reject
        //         document.body.appendChild(script)
        //     })
        // }
        // loadScript('./temp.js').then(script=>{
        //    return loadScript('./temp2.js')
        // }).then(script=>{
        //     houdunren()
        // })

    // function interval(delay = 1000, callback) {
    //     return new Promise(resolve => {
    //         let id = setInterval(() => {
    //             callback(id, resolve);
    //         }, delay);
    //     });
    // }
    // interval(100, (id, resolve) => {
    //     const div = document.querySelector("div");
    //     let left = parseInt(window.getComputedStyle(div).left);
    //     div.style.left = left + 10 + "px";
    //     if (left >= 200) {
    //         clearInterval(id);
    //         resolve(div);
    //     }
    // })//负责移动的模块
    //     .then(div => {
    //         return interval(100, (id, resolve) => {
    //             let width = parseInt(window.getComputedStyle(div).width);
    //             div.style.width = width - 10 + "px";
    //             if (width <= 20) {
    //                 clearInterval(id);
    //                 resolve(div);
    //             }
    //         });
    //     })//负责改变宽度的模块
    //     .then(div => {
    //         div.style.backgroundColor = "red";
    //     });//负责改变颜色的模块

    // function timeout(delay = 1000) {
    //     return new Promise(resolve => setTimeout(resolve, delay));
    // }
    // timeout(2000)
    //     .then(() => {
    //         console.log("houdunren.com");//等两秒打印
    //         return timeout(2000);
    //     })
    //     .then(value => {
    //         console.log("hdcms.com");//在等两秒打印
    //     });

    // function loadImage(src) {
    //     return new Promise((resolve, reject) => {
    //         const image = new Image();
    //         image.src = src;
    //         image.onload = () => {
    //             resolve(image);
    //         };
    //         image.onerror = reject;
    //         document.body.appendChild(image);
    //     });
    // }
    // loadImage("./shushu.jpg").then(image => {
    //     image.style.border = "solid 6px red";
    // });

    // const promise = new Promise((resolve, reject) => {
    //     setTimeout(() => {
    //         resolve("成功！");//五秒后打印
    //         // 或者 reject("失败！");
    //     }, 5000);
    // })
    //     .then(result => {
    //         console.log("成功:", result);//和上面那个同步
    //     })
    //     .catch(error => {
    //         console.error("失败:", error);
    //     })
    //     .finally(() => {
    //         return new Promise(resolve => {
    //             setTimeout(() => {
    //                 console.log("finally 中的异步操作完成");//五秒的基础上，再过一秒打印
    //                 resolve();
    //             }, 1000);
    //         });
    //     })
    //     .then(() => {
    //         console.log("finally 后的 then");
    //     });

// let p1=new Promise((reslove,reject)=>{
//     //reject(new Error('promise fail'))
//     // throw new Error('fail')
//     reject('rejected')

// }).then(
//     value=>{},
//     reason=>{
//         return new Promise((reslove,reject)=>{
//             reject('p2')
//         })
//     }
// )
// .then(
//     value=>console.log(value)
// ).catch(error=>{
//     console.log('catch:'+error)
// })

// let p1=new Promise((resolve,reject)=>{
// resolve('fulfilled')
// }).then(
//     value=>{
// return class{
//     static then(resolve,reject){
//         resolve(value)
//     }
// }
//         return new obj()
//     },
//     reason=>{}
// ).then(
//     value=>{
//         console.log(value)
//     }
// )
// console.log(typeof p1);

    // let p1 = new Promise((resolve, reject) => {
    //     //resolve("我是成功状态");
    //     reject("我是拒绝状态");
    // })
    //     .then(
    //         value => {
    //             return new Promise((resolve, reject) => {
    //                 setTimeout(() => {
    //                     reject("我是最外面一圈的第一个then里面resolve方法返回的新Promise，我的状态为fulfilled");
    //                 }, 3000);
    //             }).then(null, result => {
    //                 return new Promise((resolve, reject) => {
    //                     reject("我是最外面一圈的第一个then里面resolve方法返回的新Promise的then，我的状态为rejected");
    //                 });
    //             });
    //         },
    //         reason =>{
    //              return new Promise((resolve, reject) => {
    //                 reject("我是最外面一圈的第一个then里面rejected方法返回的新Promise，我的状态为rejected");
    //             });
    //         }
    //     )
    //     .then(
    //         value => {
    //             console.log("我是最外面一圈的第二个then的resolve的返回值:"+value);
    //         },
    //         reason => console.log("我是最外面一圈的第二个then的reject方法的返回值:"+reason)
    //     ); 

    // let p1 = new Promise((resolve, reject) => {
    //     reject('拒绝')
    //     //resolve('成功')
    // })
    // new Promise((resolve, reject) => {
    //     resolve(p1)
    // }).then(
    //     success=>{
    //         return new Promise((resolve,reject)=>{ resolve('解决了') })//返回一个状态为pending(准备)的promise
    //     },
    //     fail=>{
    //          return '我是第一层then返回来的值，我是fail'
    //     }
    // ).then(
    //     msg => {
    //         console.log('msg:' + msg)
    //     },
    //     error => {
    //         console.log('error:' + error)
    //     }
    // )

        // let p1 = new Promise((resolve, reject) => {
        //     //reject('拒绝')//p1的状态为拒绝
        //     //resolve('成功')//后面的这个会被前面的覆盖
        // })
        // console.log(p1)
        
        // new Promise((resolve, reject) => {
        //     resolve(p1)//把p1的状态传递给promise
        //     //此处传过来的p1无论是不是promise类型，都会被转化为promise
        // }).then(
        //       msg => {
        //         console.log('msg:' + msg)
        //     },//成功方法
        //     error => {
        //         console.log('error:' + error)
        //     }//拒绝方法
        // )

        // new Promise(resolve => {
        //     setTimeout(() => {
        //          resolve();//调换顺序以后也是先打印setTimeout
        //         console.log("setTimeout");
        //     }, 0);

        //     console.log("promise");
        // }).then(value => console.log("成功"));
        // console.log("后盾人");

        // setTimeout(() => {
        //     console.log("setTimeout");
        // }, 0);
        // new Promise(resolve => {
        //     //resolve();
        //     console.log("promise");
        // }).then(value => console.log("成功"));
        // console.log("后盾人");

        // new Promise((resolve, reject) => {
        //     reject('拒绝状态')
        //     resolve('操作成功')
        // }).then(value => {
        //     console.log('操作成功打印这个')

        // }), reason => {
        //     console.log('被拒绝了打印这个')
        // }

        // function load(src, resolve) {
        //     let script = document.createElement('script')
        //     script.src = src
        //     script.onload = resolve
        //     document.body.appendChild(script)
        // }
        // load('./0204model.js', () => {
        //     load('./0204model2.js', () => {
        //         model2()
        //     })
        // })


        // function interval(callback, delay = 50) {
        //     let id = setInterval(() => callback(id), delay);
        // }
        // interval(timeId => {
        //     const div = document.querySelector("div");
        //     let left = parseInt(window.getComputedStyle(div).left);
        //     div.style.left = left + 10 + "px";
        //     if (left >= 200) {
        //         clearInterval(timeId);
        //         interval(timeId => {
        //             let width = parseInt(window.getComputedStyle(div).width);
        //             div.style.width = width - 10 + "px";
        //             if (width <= 20) {
        //                 clearInterval(timeId);
        //             }
        //         }, 100);
        //     }
        // }, 50);
        // console.log("houdunren.com");

        // function loadImage(src, resolve, reject) {
        //     let image = new Image()
        //     image.src = src
        //     image.onload = () => {
        //         resolve(image)//将image传入resolve函数
        //     }
        //     image.onerror = reject
        // }
        // loadImage('./shushu.jpg', image => {
        //     document.body.appendChild(image)
        //     //console.log('图片加载完成')
        // }), () => {
        //     console.log('加载失败')
        // }
    </script>
</body>

</html>